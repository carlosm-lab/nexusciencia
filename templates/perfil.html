{% extends 'base.html' %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/profile.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
{% endblock %}

{% block header_title %}
<div class="header-category-title">Mi Perfil</div>
{% endblock %}

{% block content %}

<div class="profile-page-header">
    <h1 class="profile-page-title">Tu Espacio Personal</h1>
    <p class="profile-page-subtitle">Gestiona tu conocimiento y revisa tus notificaciones.</p>
</div>

<!-- Stats Grid -->
{% include 'components/stats_grid.html' %}

<div class="row g-4">

    <div class="col-lg-4">
        <div class="profile-header-card">
            <img src="{{ session.get('user_picture') }}" class="profile-pic-lg" alt="Foto de perfil">
            <h2 class="profile-name-large">{{ session.get('user_name') }}</h2>
            <p class="profile-email">{{ session.get('user_email') }}</p>

            <span class="profile-badge">LECTOR VERIFICADO</span>

            <hr class="profile-divider">

            <div class="profile-joined">
                Miembro desde <strong class="text-dark-slate">{{ session.get('fecha_registro', '2025') }}</strong>
            </div>

            <!-- Botones de configuraciÃ³n en el footer -->
            <div class="profile-footer-actions">
                <!-- Dark Mode Toggle Switch -->
                <div class="theme-toggle-wrapper profile-action-btn">
                    <svg class="theme-icon-sun" xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                        viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                    <label class="theme-switch" title="Cambiar tema" aria-label="Cambiar entre modo claro y oscuro">
                        <input type="checkbox" id="theme-toggle">
                        <span class="theme-slider"></span>
                    </label>
                    <svg class="theme-icon-moon" xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                        viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                </div>

                <!-- Logout Button -->
                <a href="{{ url_for('auth.logout') }}" class="profile-action-btn profile-action-btn-danger">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                        <polyline points="16 17 21 12 16 7"></polyline>
                        <line x1="21" y1="12" x2="9" y2="12"></line>
                    </svg>
                    <span>Cerrar SesiÃ³n</span>
                </a>
            </div>
        </div>
    </div>

    <div class="col-lg-8">
        <div class="mailbox-card">

            <div class="mailbox-header">
                <div class="mailbox-icon-wrapper">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                        <polyline points="22,6 12,13 2,6"></polyline>
                    </svg>
                </div>
                <h3 class="mailbox-title">BuzÃ³n de Mensajes</h3>
            </div>

            <div class="mailbox-content">
                {% if notificaciones %}
                <div class="notifications-list">
                    {% for noti in notificaciones %}
                    <div class="notification-item">
                        <div class="notification-header">
                            <h5 class="notification-title">{{ noti.titulo }}</h5>
                            <span class="notification-date">{{ noti.fecha.strftime('%d/%m') }}</span>
                        </div>
                        <p class="notification-text">
                            {{ noti.mensaje }}
                        </p>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="mailbox-empty">
                    <div class="mailbox-empty-icon">ðŸ“­</div>
                    <p>No tienes mensajes nuevos.</p>
                </div>
                {% endif %}
            </div>

        </div>
    </div>

</div>

<div class="row mt-4">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h3 class="section-title-library mb-0">ðŸ“š Tu Biblioteca de InvestigaciÃ³n</h3>
            {% if articulos_guardados %}
            <button id="btn-empty-library" class="btn-dark-admin"
                style="background-color: #FEF2F2; color: #EF4444; border: 1px solid #FECACA; font-size: 0.85rem; padding: 8px 16px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="3 6 5 6 21 6"></polyline>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                </svg>
                Vaciar Biblioteca
            </button>
            {% endif %}
        </div>

        <div class="table-card">
            <div class="table-responsive">
                <table class="table table-hover mb-0 management-table">
                    <thead>
                        <tr>
                            <th>TÃ­tulo del ArtÃ­culo</th>
                            <th>Guardado</th>
                            <th class="text-right">Gestionar</th>
                        </tr>
                    </thead>
                    <tbody id="libraryTableBody">
                        {% for art in articulos_guardados %}
                        <tr class="article-row">
                            <td class="article-title-cell">
                                <a href="{{ url_for('main.ver_articulo', cat_slug=get_category_slug(art.categoria), slug=art.slug) }}"
                                    class="article-link-wrapper">
                                    <strong class="article-title-text">{{ art.titulo }}</strong>
                                    <div class="article-meta-wrapper">
                                        <span class="badge-category">{{ art.categoria }}</span>
                                    </div>
                                </a>
                            </td>

                            <td class="article-date-cell">
                                {{ art.fecha.strftime('%d/%m/%Y') }}
                            </td>

                            <td class="text-right">
                                <button class="btn-action-sm btn-save-card saved" type="button"
                                    title="Quitar de biblioteca" data-id="{{ art.id }}" data-available="true"
                                    style="color:#EF4444; border: 1px solid #FECACA; background: #FEF2F2; cursor: pointer; z-index: 10; position: relative;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                        fill="currentColor" stroke="currentColor" stroke-width="2"
                                        stroke-linecap="round" stroke-linejoin="round" style="pointer-events: none;">
                                        <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2-2z"></path>
                                    </svg>
                                </button>
                            </td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="3" class="library-empty-state">
                                <div class="library-empty-icon">ðŸ“­</div>
                                AÃºn no tienes artÃ­culos guardados.
                                <br>
                                <a href="/" class="library-empty-link">Explorar repositorio â†’</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/main.js') }}"></script>
{% endblock %}