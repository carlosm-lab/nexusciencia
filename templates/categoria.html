{% extends 'base.html' %}

{% block title %}{{ categoria_nombre }} | NexusCiencia{% endblock %}

{% block description %}Art√≠culos cient√≠ficos sobre {{ categoria_nombre }}. Explora {{ total_articulos }} publicaciones
acad√©micas en esta √°rea de psicolog√≠a.{% endblock %}

{% block og_title %}{{ categoria_nombre }} | NexusCiencia{% endblock %}
{% block og_description %}{{ total_articulos }} art√≠culos cient√≠ficos sobre {{ categoria_nombre }}{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
<style>
    .category-hero {
        margin-bottom: 2rem;
    }

    .category-hero-content {
        display: flex;
        align-items: center;
        gap: 1.25rem;
    }

    .category-hero-icon {
        font-size: 2.5rem;
        width: 72px;
        height: 72px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(139, 92, 246, 0.15));
        border-radius: 16px;
        flex-shrink: 0;
    }

    .category-hero-text h1 {
        font-size: 1.75rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 0.25rem;
    }

    .category-hero-text p {
        color: var(--text-secondary);
        font-size: 0.95rem;
    }

    .category-stats {
        display: flex;
        gap: 1.5rem;
        margin-top: 1rem;
    }

    .category-stat {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.875rem;
        color: var(--text-tertiary);
    }

    .category-stat strong {
        color: var(--text-primary);
        font-weight: 600;
    }

    .breadcrumb-nav {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.875rem;
        color: var(--text-tertiary);
        margin-bottom: 1.5rem;
    }

    .breadcrumb-nav a {
        color: var(--accent-color);
        text-decoration: none;
        transition: opacity 0.2s;
    }

    .breadcrumb-nav a:hover {
        opacity: 0.8;
    }

    .breadcrumb-separator {
        color: var(--text-tertiary);
    }

    .articles-section-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 1rem;
        padding-bottom: 0.75rem;
        border-bottom: 1px solid var(--border-color);
    }
</style>
{% endblock %}

{% block header_title %}
<div class="header-category-title">{{ categoria_emoji }} {{ categoria_nombre }}</div>
{% endblock %}

{% block content %}

<!-- Breadcrumb Navigation -->
<nav class="breadcrumb-nav" aria-label="Breadcrumb">
    <a href="{{ url_for('main.inicio') }}">Inicio</a>
    <span class="breadcrumb-separator">‚Ä∫</span>
    <a href="{{ url_for('main.categorias') }}">Categor√≠as</a>
    <span class="breadcrumb-separator">‚Ä∫</span>
    <span>{{ categoria_nombre }}</span>
</nav>

<!-- Category Hero -->
<div class="category-hero">
    <div class="category-hero-content">
        <div class="category-hero-icon">{{ categoria_emoji }}</div>
        <div class="category-hero-text">
            <h1>{{ categoria_nombre }}</h1>
            <p>Explora art√≠culos cient√≠ficos en esta √°rea de estudio</p>
            <div class="category-stats">
                <div class="category-stat">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                    </svg>
                    <strong>{{ total_articulos }}</strong> art√≠culo{% if total_articulos != 1 %}s{% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Articles Section -->
<h2 class="articles-section-title">Art√≠culos en esta categor√≠a</h2>

{% if articulos %}
<div class="library-grid">
    {% for art in articulos %}
    <div class="book-card">
        <a href="{{ url_for('main.ver_articulo', cat_slug=categoria_slug, slug=art.slug) }}" class="book-cover-link">
            <div class="book-cover {{ loop.cycle('cover-blue', 'cover-purple', 'cover-dark', 'cover-green') }}">
                <span class="read-hint">Clic para leer</span>
                <svg class="card-decoration-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="2" y1="12" x2="22" y2="12"></line>
                    <path
                        d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z">
                    </path>
                </svg>
                <div class="book-title">{{ art.titulo }}</div>
            </div>
        </a>
        <div class="book-actions">
            <div class="actions-default" id="actions-{{ art.id }}">
                <button type="button"
                    class="btn-book-action btn-save-card {% if art.id in ids_guardados %}saved{% endif %}"
                    title="Guardar" data-id="{{ art.id }}" data-available="true">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                        fill="{% if art.id in ids_guardados %}currentColor{% else %}none{% endif %}"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
                    </svg>
                </button>

                <button type="button" class="btn-book-action action-play" title="Escuchar Podcast"
                    onclick="playCardAudio('{{ art.id }}')" data-available="{{ 'true' if art.url_audio else 'false' }}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                        <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                    </svg>
                </button>

                <a href="{{ art.url_pdf if art.url_pdf else 'javascript:void(0);' }}" target="_blank"
                    class="btn-book-action action-pdf" title="Descargar PDF"
                    data-available="{{ 'true' if art.url_pdf else 'false' }}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                </a>
            </div>

            {% if art.url_audio %}
            <audio id="audio-{{ art.id }}" style="display: none;" preload="none">
                <source src="{{ art.url_audio }}" type="audio/mpeg">
            </audio>
            <div class="actions-player hidden" id="player-wrapper-{{ art.id }}">
                <button type="button" class="btn-book-action" title="Reiniciar" onclick="rewindAudio('{{ art.id }}')">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2">
                        <polygon points="19 20 9 12 19 4 19 20"></polygon>
                        <line x1="5" y1="19" x2="5" y2="5"></line>
                    </svg>
                </button>
                <button type="button" class="btn-book-action action-stop-custom" title="Pausar"
                    onclick="stopCardAudio('{{ art.id }}')">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2">
                        <rect x="6" y="4" width="4" height="16"></rect>
                        <rect x="14" y="4" width="4" height="16"></rect>
                    </svg>
                </button>
                <button type="button" class="btn-book-action" title="+10s" onclick="forwardAudio('{{ art.id }}')">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2">
                        <polygon points="5 4 15 12 5 20 5 4"></polygon>
                        <line x1="19" y1="5" x2="19" y2="19"></line>
                    </svg>
                </button>
            </div>
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>

{# Paginaci√≥n #}
{% set pagination_obj = articulos_pag %}
{% include 'components/pagination.html' %}

{% else %}
<div class="empty-state-container" style="text-align: center; padding: 3rem 1rem;">
    <div style="font-size: 3rem; margin-bottom: 1rem;">üì≠</div>
    <h3 style="color: var(--text-primary); margin-bottom: 0.5rem;">No hay art√≠culos a√∫n</h3>
    <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">Esta categor√≠a a√∫n no tiene art√≠culos publicados.
    </p>
    <a href="{{ url_for('main.categorias') }}"
        style="color: var(--accent-color); text-decoration: none; font-weight: 500;">‚Üê Volver a categor√≠as</a>
</div>
{% endif %}

<!-- JSON-LD Structured Data -->
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "CollectionPage",
    "name": "{{ categoria_nombre }}",
    "description": "Art√≠culos cient√≠ficos sobre {{ categoria_nombre }} en NexusCiencia",
    "url": "{{ request.url_root.rstrip('/') }}{{ url_for('main.ver_categoria', slug=categoria_slug) }}",
    "breadcrumb": {
        "@type": "BreadcrumbList",
        "itemListElement": [
            {
                "@type": "ListItem",
                "position": 1,
                "name": "Inicio",
                "item": "{{ request.url_root.rstrip('/') }}"
            },
            {
                "@type": "ListItem",
                "position": 2,
                "name": "Categor√≠as",
                "item": "{{ request.url_root.rstrip('/') }}{{ url_for('main.categorias') }}"
            },
            {
                "@type": "ListItem",
                "position": 3,
                "name": "{{ categoria_nombre }}"
            }
        ]
    },
    "mainEntity": {
        "@type": "ItemList",
        "numberOfItems": {{ total_articulos }},
        "itemListElement": [
            {% for art in articulos_json %}
            {
                "@type": "ListItem",
                "position": {{ loop.index }},
                "item": {
                    "@type": "Article",
                    "name": "{{ art.nombre }}",
                    "url": "{{ request.url_root.rstrip('/') }}{{ art.url }}"
                }
            }{% if not loop.last %},{% endif %}
            {% endfor %}
        ]
    }
}
</script>

{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}